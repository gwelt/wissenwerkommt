<!DOCTYPE html>
<html lang="de">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/png" href="images/apple-touch-icon-precomposed.png">
<meta name="theme-color" content="#000">
<meta name="Description" content="wissenwerkommt">
<title>wissenwerkommt</title>
<script>
var team=false;
var socket=false;
var currentView=undefined;
var is_mobile=1;
var QRCode=undefined;

// Polyfills
if ((!Array.prototype.includes)||(!Array.prototype.find)) {loadScript('polyfills.js',function(){})}

// dynamically add manifest.json because it has to be delivered from team-subdirectory
if (window.location.pathname.substr(1)) {
  link=document.createElement('link');
  link.href=window.location.pathname.substr(1)+'/manifest.json';
  link.rel='manifest';
  document.getElementsByTagName('head')[0].appendChild(link);
}

// load socket.io after waiting for a second ... let the first getTeam be operated by AJAX to have a quick start before socket.io loads
//setTimeout(function(){SocketIO()},1000);
function SocketIO() {if (!socket) {loadScript('/socket.io/socket.io.js', function() {
  socket=io();
  socket.on('update', function (json) {if (json.teamid==team.teamid) {getTeam(team.teamid)}});
  socket.on('team', function (json) {updateView(json)});
  getTeam();
})}};

// Service-Worker
//registerServiceWorker();
function registerServiceWorker() {
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/service-worker.js');
    });
  }
}
//window.addEventListener('offline', function(event){console.log("You lost connection.");});
//window.addEventListener('online', function(event){console.log("You are now back online.");});

function loadScript(src, done) {
  var js = document.createElement('script');
  js.src = src;
  js.onload = function() {done(src+' executed')};
  document.head.appendChild(js);
}

function addOnKeyCode13EventListener(id_of_element_to_listen_to,id_of_element_to_click) {
  document.getElementById(id_of_element_to_listen_to).addEventListener("keyup", function(event) {
    event.preventDefault();
    if (event.keyCode === 13) {document.getElementById(id_of_element_to_click).click();}
  });
}

function updateView(json) {
  var time=stopwatch();
  team=json?JSON.parse(json):false;

  // create readable string for recurrence of events
  var teams_weekday_time=get_teams_weekday_time(team);
  document.title='wissenwerkommt';
  var svg_menu='<svg xmlns="http://www.w3.org/2000/svg" id="svg_menu" fill="#000" width="24px" height="18px" viewBox="0 0 24 24"><path d="M24 6h-24v-4h24v4zm0 4h-24v4h24v-4zm0 8h-24v4h24v-4z"/></svg>';

  var mobile_head=document.getElementById('mobile_head');
  var mobile_main=document.getElementById('mobile_main');
  var mobile_options=document.getElementById('mobile_options');
  var mobile_footer=document.getElementById('mobile_footer');

  if (!team) {

    mobile_head.innerHTML="<div class='head_wrapper'><button aria-label='toggleView' class='option_button' onclick=toggleView();>"+svg_menu+"</button><a href=/ style=text-decoration:none;font-weight:bold>wissenwerkommt</a><br><div style=font-size:0.7em>Startseite</div></div>";
    mobile_main.innerHTML='<div id="main01"><div class="form_wrapper"><input type="text" id="visitteamid" maxlength=16 value="'+window.location.pathname.substr(1)+'" placeholder="Team-ID" autocomplete="off"><button aria-label="Team aufrufen" id="team_aufrufen" class="button_ok" onclick=getTeam(document.getElementById("visitteamid").value)>Team aufrufen</button></div><br><div class="textblock_wrapper">...oder erstelle dein eigenes Team!</div><div class="form_wrapper"><button aria-label="Team anlegen" class="button_ok" onclick="document.getElementById(\'main02\').style.display=\'block\';document.getElementById(\'main01\').style.display=\'none\'">neues Team</button></div><br></div><div id="main02" style=display:none><div class="form_wrapper"><input type="text" id="name" maxlength=24 value="" placeholder="Name deines Teams" autocomplete="off"><br>'+get_team_weekdaytime_selection(team)+'<br><input type="text" id="teamid" maxlength=16 value="'+window.location.pathname.substr(1)+'" placeholder="Team-ID *" autocomplete="off"><br><input type="text" id="admintoken" maxlength=16 value="'+(team.admintoken||'')+'" placeholder="Admin-Token" autocomplete="off"><input type="hidden" id="teamtoken" maxlength=16 value="'+(team.teamtoken||'')+'" autocomplete="off"><br><button aria-label="Team erstellen" class="button_ok" onclick=addTeam()>Team erstellen</button><br></div></div><div class="textblock_wrapper" id="teamlist"></div><div class="textblock_wrapper" id="stats"></div>';
    mobile_footer.innerHTML="";
    addOnKeyCode13EventListener('visitteamid','team_aufrufen');
    serverRequest('getListOfTeamIDs',{},function (r){r=JSON.parse(r); r.forEach(function (t){document.getElementById('teamlist').innerHTML+='<a href=/'+t+'>'+t+'</a> '})});
    serverRequest('stats',{},function (r){document.getElementById('stats').innerHTML=r});

  }

  else { //if (team) {

    if (team.error) {

      // MAIN-page if a team is requested but not found or not allowed
      debug(JSON.stringify(team));
      message('',false); // don't want the message here...
      mobile_head.innerHTML="<div class='head_wrapper'><button aria-label='toggleView' class='option_button' onclick=toggleView();>"+svg_menu+"</button><a href=/ style=text-decoration:none;font-weight:bold>wissenwerkommt</a><br><div style=font-size:0.7em>/<a href=/"+window.location.pathname.substr(1)+">"+window.location.pathname.substr(1)+"</a></div></div>";
      mobile_main.innerHTML='<div class="error_wrapper"><div class="error_text" style=padding-bottom:12px>Das Team hat einen Code für den Zugriff vereinbart:</div><button aria-label="Token eingeben" style="width:100%" onclick=show_cookie_prompt(\'token\')>Token eingeben</button></div>';

    } else {

      // MAIN-page if a team is requested
      document.title=(!!team.name?team.name:'Team '+team.teamid);

      mobile_head.innerHTML="<div class='head_wrapper'><button aria-label='toggleView' class='option_button' onclick=toggleView();>"+svg_menu+"</button><a href=/"+team.teamid+" style=text-decoration:none;font-weight:bold"+((!teams_weekday_time.length)?';position:relative;top:10px':'')+">"+(!!team.name?team.name:'Team '+team.teamid)+"</a><br><div style=font-size:0.7em>"+teams_weekday_time+"</div></div>";

      //---------- EVENTS ----------//
      var name=getCookie('name',true);
      mobile_main.innerHTML='';
      var event_counter=0;
      team.events?team.events.forEach(function (e) {
        event_counter++;

        var comment_inline='';
        if (e.comment) {comment_inline='<div class="comment_wrapper">'+(e.comment?e.comment:'')+'</div>';}
        var comment_important='';
        if (e.cancelled) {comment_important='<div class=comment_important>TERMIN FÄLLT AUS</div>';}
        var comment_hint='';
        // check if event is NOT a recurring event
        if (!(team.recurrence?team.recurrence.filter(function(r){return (((r.weekday==new Date(e.datetime).getDay())||(r.weekday==7))&&(r.time==e.datetime.substring(11,16)))}):[1]).length) {
          comment_hint='<div class=comment_hint>Termin außerhalb der Serie</div>';
        }
        var peoples_list='';
        if (e.attendees) {e.attendees.forEach(function (att) {peoples_list+='<div class="attendee_item">'+att+'</div>'});}
        if (e.refusals) {e.refusals.forEach(function (ref) {peoples_list+='<div class="refusal_item">'+ref+'</div>'});}
        var attendees_counter=(e.attendees?'<div class="attendeescount_wrapper">'+(e.attendees?e.attendees.length:0)+' Teilnehmer'+get_time_to_go_till_event_starts(e)+'</div>':'');
        var peoples_list_container='<div id="peoples_list_container_'+event_counter+'">'+peoples_list+'</div>';
        var day=['So','Mo','Di','Mi','Do','Fr','Sa'][new Date(e.datetime).getDay()]+' '+e.datetime.substring(8,10)+'.'+e.datetime.substring(5,7)+'. '+e.datetime.substring(11,16)+' Uhr';
        var ondblclick='';
        if ((team.userlevel)&&(team.userlevel>1)) {ondblclick=" onclick=\"_ondblclick(function(){show_teamCommentEdit_prompt(\'"+e.datetime+"\',\'"+(e.comment?e.comment:'')+"\',"+(e.cancelled?true:false)+")})\"";}

        // content
        mobile_main.innerHTML+='<div id="div'+e.datetime+'" class="statusbutton_wrapper"'+ondblclick+'><button aria-label="'+day+'" id="status'+e.datetime+'" onclick=toggleStatus("'+e.datetime+'")>'+day+'</button><br>'+comment_important+comment_hint+comment_inline+peoples_list_container+attendees_counter+'</div>';
        document.getElementById('peoples_list_container_'+event_counter).className='statusbutton_wrapper_attendees_following';

        // set button-attributes to represent the state of attendence
        if (e.attendees&&e.attendees.includes(name)) {document.getElementById('status'+e.datetime).className='statusbutton_attending'}
        else if (e.refusals&&e.refusals.includes(name)) {document.getElementById('status'+e.datetime).className='statusbutton_refused'}
        else {document.getElementById('status'+e.datetime).className='statusbutton_undecided'}

        if ((!name)&&(currentView!='mobile_options')) {message('Klicke einen <span style="background-image:linear-gradient(#ffbf00 84%,#efaf00 0%)">Termin</span> 1x an um deine <u>Teilnahme</u> mitzuteilen. Klicke erneut für eine <u>Absage</u>.')}

      }):false;

      debug(JSON.stringify(team));
    }

    mobile_footer.innerHTML="<div id='footer_wrapper' class='footer_wrapper'><div style=font-size:0.7em;text-align:center>Immer besser zu <a href=/>wissenwerkommt</a>.</div></div>";
  }

  //---------- MENU ----------//
  var text='';
  var cookie=undefined;
  var svg='';
  var menu='';
  var admin_menu='';

  // MENU:NAME
  text='Mit welchem Namen möchtest du dich anmelden?';
  cookie=getCookie("name",true);
  if (cookie) {text='Hallo <b>'+cookie+'</b>.<br>Schön, dass du da bist.';}
  svg='';
  menu+='<div class="options_option"><button aria-label="Name" class="option_button" onclick="show_cookie_prompt(\'name\');">'+svg+'</button><div class="option_text">'+text+'</div></div>';

  // MENU:TOKEN
  cookie=getCookie("token",true);
  //text='Hier kannst du einen Token-Code eingeben.';
  text='Zur Team-Administration musst du einen Token angeben.';
  if (cookie) {text='Dein Token:<br><b>'+cookie+'</b>'}
  svg='';
  menu+='<div class="options_option"><button aria-label="Token" class="option_button" onclick="show_cookie_prompt(\'token\');">'+svg+'</button><div class="option_text">'+text+'</div></div>';

  if ((team)&&(team.userlevel)&&(team.userlevel>1)) {
    admin_menu+='<div class="divider">Termine</div>';
    // ADMIN_MENU:NEW EVENT
    admin_menu+='<div class="options_option"><button aria-label="Termin hinzufügen" class="option_button" onclick="show_teamAddEvent_prompt()"></button><div class="option_text">Termin hinzufügen</div></div>';
    // ADMIN_MENU:DELETE EVENT
    admin_menu+='<div class="options_option"><button aria-label="Termin bearbeiten" class="option_button" onclick="show_teamDeleteEvent_prompt()"></button><div class="option_text">Termin bearbeiten / absagen</div></div>';
    // ADMIN_MENU:DATETIME
    admin_menu+='<div class="options_option"><button aria-label="Terminserie" class="option_button" onclick="show_teamPreferenceWeekdayTime_prompt(team)"></button><div class="option_text">Terminserie:<br><b>'+(teams_weekday_time.length?teams_weekday_time:'keine (unregelmäßig)')+'</b></div></div>';
    admin_menu+='<div class="divider">Team</div>';
    // ADMIN_MENU:TEAM-NAME
    admin_menu+='<div class="options_option"><button aria-label="Name des Teams" class="option_button" onclick="show_teamPreference_prompt(\'<b>Name</b> des Teams:\',\'name\',\''+(team.name?team.name:'')+'\',\'\');"></button><div class="option_text">Name des Teams:<br><b>'+(team.name?team.name:'Team '+team.teamid)+'</b></div></div>';
    // ADMIN_MENU:TEAM-ID
    admin_menu+='<div class="options_option"><button aria-label="Team-ID" class="option_button" onclick="show_teamPreference_prompt(\'<b>Team-ID</b> / Aufruf-URL:\',\'new_teamid\',\''+(team.teamid?team.teamid:'')+'\',\'Achtung! Mit der Team-ID veränderst du auch den Aufruf-Link (URL) für dein Team!\');"></button><div class="option_text">ID des Teams:<br><b>'+team.teamid+'</b></div></div>';
    // ADMIN_MENU:ADMIN-TOKEN
    admin_menu+='<div class="options_option"><button aria-label="Admin-Token" class="option_button" onclick="show_teamPreference_prompt(\'<b>Admin-Token</b>:\',\'admintoken\',\''+(team.admintoken?team.admintoken:'')+'\',\'Achtung! Wenn du den Admin-Token veränderst, wirst du gleich selbst nicht mehr Admin sein. Du musst den Token dann erst selbst neu angeben!\');"></button><div class="option_text">Admin-Token:'+(team.admintoken?'<br><b>'+team.admintoken+'</b>':' keiner<br>Jeder darf administrieren.')+'</div></div>';
    // ADMIN_MENU:TEAM-TOKEN
    admin_menu+='<div class="options_option"><button aria-label="Team-Token" class="option_button" onclick="show_teamPreference_prompt(\'<b>Team-Token</b>:\',\'teamtoken\',\''+(team.teamtoken?team.teamtoken:'')+'\',\'Vergiss nicht, deinem Team den neuen Team-Token mitzuteilen!\');"></button><div class="option_text">Team-Token:'+(team.teamtoken?'<br><b>'+team.teamtoken+'</b>':' keiner<br>Jeder darf teilnehmen.')+'</div></div>';
    // ADMIN_MENU:DELETE TEAM
    admin_menu+='<div class="options_option"><button aria-label="Team löschen" class="option_button" onclick="show_teamDeleteTeam_prompt()"></button><div class="option_text">Team löschen</div></div>';
    admin_menu+='<div class="divider"></div>';
  }

  var l=""+window.location;
  team_name_and_recurrence='';
  if (team.teamid!=undefined) {team_name_and_recurrence+='<br><b>'+(!!team.name?team.name:'Team '+team.teamid)+'</b><br>'+((teams_weekday_time!='')?teams_weekday_time+'<br>':'')}
  var promo='<div class="options_promo"><div class="option_text"><a href='+l+'><canvas id="qrcode" style=display:none></canvas></a>'+team_name_and_recurrence+'<br><a href='+l+'>'+l.substring(0,l.lastIndexOf("/")+1)+'<br>'+window.location.pathname.substr(1)+'</a></div></div>';

  mobile_options.innerHTML='<div class="options_wrapper">'+menu+admin_menu+promo+'</div>';
  if (currentView=='mobile_options') {showQRcode(""+window.location)};

  console.log('updateView: '+stopwatch(time)+'ms');
}

function get_time_to_go_till_event_starts(e) {
  // calculate time to go till event starts
  var time_to_go_till_event_starts='';
  var minutes_to_go=Math.floor((new Date(e.datetime)-new Date())/60000)+1;
  if (minutes_to_go<1) {time_to_go_till_event_starts='gestartet'}
  else if (minutes_to_go<5) {time_to_go_till_event_starts='startet gleich'}
  else if (minutes_to_go<60) {time_to_go_till_event_starts='noch '+minutes_to_go+' Minuten'}
  else {
    var hours_to_go=Math.floor(minutes_to_go/60);
    if (hours_to_go<12) {time_to_go_till_event_starts='noch '+hours_to_go+':'+((minutes_to_go%60>9)?minutes_to_go%60:'0'+minutes_to_go%60)+' Stunden'}
    else if (hours_to_go<24) {time_to_go_till_event_starts='noch '+Math.round(minutes_to_go/60)+' Stunden'}
    else {
      var days_to_go=Math.floor((new Date(e.datetime)-new Date().setHours(0,0,0,0))/86400000);
      if (days_to_go==1) {time_to_go_till_event_starts='startet morgen'} else {
        time_to_go_till_event_starts='noch '+days_to_go+' Tage';
      }
    }
  }
  if (time_to_go_till_event_starts!='') {time_to_go_till_event_starts=' | '+time_to_go_till_event_starts}
  return time_to_go_till_event_starts;
}

function get_teams_weekday_time(team) {
  // example: from "mittwochs 20:00" and "donnerstags 20:00" generate "MI-DO 20:00"
  var teams_weekday_time=[];
  if ((team)&&(team.recurrence)) {
    // order items by weekday
    team.recurrence.sort(function(a,b){return (a.weekday!=0?a.weekday:7)-(b.weekday!=0?b.weekday:7)});

    var last_time=undefined;
    var i=-1;
    while (++i<team.recurrence.length) {
      var teams_weekday=translate(team.recurrence[i].weekday);

      // if time is the same like previous item and the previous item is one weekday before, display-"merge" them and replace previous one
      // precondition: items have to be ordered by weekday with sunday (0) after saturday (6) (see above)
      // omit weekday 7 (täglich/every day)
      if ( (team.recurrence[i].time==last_time)&&(team.recurrence[i].weekday!=7)&&((((team.recurrence[i-1].weekday)-(team.recurrence[i].weekday-1))%7)==0) ) {
        var first_of_equal_items=i;
        while ((team.recurrence[first_of_equal_items-1]) // previous item exists
          &&(team.recurrence[first_of_equal_items-1].time==team.recurrence[i].time) // time of current item is the same like previous item
          &&((((team.recurrence[i-1].weekday)-(team.recurrence[i].weekday-1))%7)==0) ) // previous item is one weekday before current item
        {
          first_of_equal_items--; // try previous of this previous one next
        }
        teams_weekday_time.pop(); // delete previous one
        teams_weekday=translate(team.recurrence[first_of_equal_items].weekday)+'-'+translate(team.recurrence[i].weekday); // "merge" them (display range from first to last item)
      }

      last_time=team.recurrence[i].time;
      teams_weekday_time.push(" "+teams_weekday+" "+((team.recurrence[i].time)?team.recurrence[i].time:''));

      function translate(wd) {
        var weekdays=[[1,'montags'],[2,'dienstags'],[3,'mittwochs'],[4,'donnerstags'],[5,'freitags'],[6,'samstags'],[0,'sonntags'],[7,'täglich'],[8,'unregelmäßig']];
        var weekdays_short=[[1,'MO'],[2,'DI'],[3,'MI'],[4,'DO'],[5,'FR'],[6,'SA'],[0,'SO'],[7,'täglich'],[8,'unregelmäßig']];
        var j=-1; while (++j<weekdays.length) {
          if (wd==weekdays[j][0]) {
            return team.recurrence.length>1?weekdays_short[j][1]:weekdays[j][1];
          }
        };
      }

    }
  }
  return teams_weekday_time;
}

function get_team_weekdaytime_selection(team,blockNumber,hidden) {
  // special case: blockNumber is not defined in case of a "create a new team"-form - current weekday and time will be preset in this case
  var preset=8;
  if (blockNumber===undefined) {blockNumber=0;} //preset=new Date().getDay()
  var selected='';
  // prepare weekday-selection
  var weekdays=[[1,'montags'],[2,'dienstags'],[3,'mittwochs'],[4,'donnerstags'],[5,'freitags'],[6,'samstags'],[0,'sonntags'],[7,'täglich'],[8,'unregelmäßig']];
  var preset_weekday=(team.recurrence)&&(team.recurrence[blockNumber])&&(team.recurrence[blockNumber].weekday)?team.recurrence[blockNumber].weekday:preset;
  var weekday_selection='<select id="weekday'+blockNumber+'" style="width:100%" onchange="display_hour_selection(\''+blockNumber+'\')">';
  var teams_weekday='';
  var i=-1;
  while (++i<weekdays.length) {
    if (preset_weekday==weekdays[i][0]) {selected=' selected'; teams_weekday=weekdays[i][1]} else {selected=''}
    weekday_selection+='<option value="'+weekdays[i][0]+'"'+selected+'>'+weekdays[i][1]+'</option>';
  }
  weekday_selection+='</select>';

  var doNotDisplay='';
  if (preset_weekday==8) {doNotDisplay=' style=display:none'}
  // prepare time-selection
  var preset_hour=(team.recurrence)&&(team.recurrence[blockNumber])&&(team.recurrence[blockNumber].time)?team.recurrence[blockNumber].time.slice(0,2):new Date().getHours();
  var hour_selection='<select id="hour'+blockNumber+'"'+doNotDisplay+'>';
  var hour=-1; while (++hour<24) {
    hour<10?hour='0'+hour:true;
    if (hour==preset_hour) {selected=' selected'} else {selected=''}
    hour_selection+='<option value="'+hour+'"'+selected+'>'+hour+'</option>';
  }
  hour_selection+='</select>';
  var preset_minute=(team.recurrence)&&(team.recurrence[blockNumber])&&(team.recurrence[blockNumber].time)?team.recurrence[blockNumber].time.slice(3,5):(Math.floor(new Date().getMinutes()/5)*5);
  var minute_selection='<select id="minute'+blockNumber+'"'+doNotDisplay+'>';
  var minute=0; while (minute<60) {
    minute<10?minute='0'+minute:true;
    if (minute==preset_minute) {selected=' selected'} else {selected=''}
    minute_selection+='<option value="'+minute+'"'+selected+'>'+minute+'</option>';
    minute=minute*1+5;
  }
  minute_selection+='</select>';

  if (hidden) {
    return '<div id="addRecurrence'+blockNumber+'" style="display:none">'+weekday_selection+hour_selection+' '+minute_selection+'</div><div class="prompt_text_top" id="link'+blockNumber+'"><span style=text-decoration:underline;cursor:pointer; onclick=document.getElementById(\'addRecurrence'+blockNumber+'\').style.display=\'block\';document.getElementById(\'link'+blockNumber+'\').style.display=\'none\';>Wochentag hinzufügen</span></div>';
  } else {
    return weekday_selection+hour_selection+' '+minute_selection;
  }
}

function show_teamPreferenceWeekdayTime_prompt(team) {
  var e=document.getElementById('mobile_prompt');
  e.innerHTML='<div class="prompt_wrapper"><div class="prompt_text_top"><b>Wann</b> findet der Termin statt?</div><input type="hidden" id="teamid" value="'+window.location.pathname.substr(1)+'" autocomplete="off"><div id=weekdaytime_selection></div><button aria-label="ok" class="button_ok" onclick="editTeam();hide_prompt();">ok</button><div style=clear:both></div><div class="prompt_text_bottom"><br><a href=javascript:hide_prompt()>Abbrechen</a></div></div>';

  // create multiple selections according to team recurrences
  var i=0;
  document.getElementById('weekdaytime_selection').innerHTML+=get_team_weekdaytime_selection(team,i);
  if (team.recurrence) {
    while (++i<team.recurrence.length) {
      document.getElementById('weekdaytime_selection').innerHTML+=get_team_weekdaytime_selection(team,i);
    }
    if (i<7) {document.getElementById('weekdaytime_selection').innerHTML+=get_team_weekdaytime_selection(team,i,true)}
  }

  document.getElementById('mobile_inner').style.display='none';
  e.style.display='block';
}
function show_teamPreference_prompt(text,param,preval,subline) {
  var e=document.getElementById('mobile_prompt');
  e.innerHTML='<div class="prompt_wrapper"><div class="prompt_text_top">'+text+'</div><input type="hidden" id="teamid" value="'+window.location.pathname.substr(1)+'" autocomplete="off"><input type="text" id="'+param+'" maxlength=24 value="'+preval+'" placeholder="" autocomplete="off"><button aria-label="ok" id="okTeamPreference" class="button_ok" onclick="editTeam();hide_prompt();">ok</button><div style=clear:both></div><div class="prompt_text_bottom">'+(subline?subline+'<br>':'')+'<br><a href=javascript:hide_prompt()>Abbrechen</a></div></div>';
  document.getElementById('mobile_inner').style.display='none';
  addOnKeyCode13EventListener(param,'okTeamPreference');
  e.style.display='block';
  document.getElementById(param).focus();
}
function show_teamDeleteTeam_prompt() {
  var e=document.getElementById('mobile_prompt');
  e.innerHTML='<div class="prompt_wrapper"><div class="prompt_text_top">Möchtest du dieses Team unwiderruflich <b>löschen</b>?<br><br><i>'+(team.name?team.name:'Team '+team.teamid)+'</i></div><input type="hidden" id="teamid" value="'+window.location.pathname.substr(1)+'" autocomplete="off"><button aria-label="ok" class="button_ok" onclick="deleteTeam();hide_prompt();">Team löschen</button><div style=clear:both></div><div class="prompt_text_bottom"><br><a href=javascript:hide_prompt()>Abbrechen</a></div></div>';
  document.getElementById('mobile_inner').style.display='none';
  e.style.display='block';
}
function show_teamAddEvent_prompt() {
  var e=document.getElementById('mobile_prompt');
  e.innerHTML='<div class="prompt_wrapper"><div class="prompt_text_top"><b>Wann</b> findet der Termin statt?</div><input type="hidden" id="teamid" value="'+window.location.pathname.substr(1)+'" autocomplete="off"><input type="text" id="datetime" value="'+getDateString()+'T00:00" placeholder="datetime" autocomplete="off"><div class="prompt_text_top"><b>Hinweis</b> zum Termin:</div><input type="text" id="comment" maxlength=140 value="Einzeltermin" placeholder="Angabe erforderlich" autocomplete="off"><button aria-label="ok" class="button_ok" onclick="addEvent();hide_prompt();">ok</button><div style=clear:both></div><div class="prompt_text_bottom"><br><a href=javascript:hide_prompt()>Abbrechen</a></div></div>';
  document.getElementById('mobile_inner').style.display='none';
  e.style.display='block';
  document.getElementById('datetime').focus();
}
function show_teamDeleteEvent_prompt() {
  var e=document.getElementById('mobile_prompt');
  e.innerHTML='<div class="prompt_wrapper"><div class="prompt_text_top">Mit einem <b>Doppelklick auf einen Termin</b> kannst du einen Dialog öffnen. Administratoren können dort<ul><li>einen Hinweis zum Termin hinterlegen oder</li><li>den Termin absagen.</li></ul>Hinweis: Termine, die nicht zu einer Serie gehören, werden automatisch gelöscht, wenn keine Zusagen, Absagen oder Hinweise vorhanden sind. Serientermine können nur abgesagt (nicht gelöscht) werden.<p></div><button aria-label="ok" class="button_ok" onclick="hide_prompt();">ok</button><div style=clear:both></div><!--<div class="prompt_text_bottom"><br><a href=javascript:hide_prompt()>Abbrechen</a></div>--></div>';
  document.getElementById('mobile_inner').style.display='none';
  e.style.display='block';
}
function show_teamCommentEdit_prompt(datetime,preval_comment,cancelled) {
  var e=document.getElementById('mobile_prompt');
  e.innerHTML='<div class="prompt_wrapper"><div class="prompt_text_top"><b>Hinweis</b> zum Termin:</div><input type="hidden" id="teamid" value="'+window.location.pathname.substr(1)+'" autocomplete="off"><input type="text" id="comment'+datetime+'" maxlength=140 value="'+preval_comment+'" placeholder="" autocomplete="off"><button aria-label="ok" id="okCommentEdit" class="button_ok" onclick="commentEvent(\''+datetime+'\');hide_prompt();">ok</button><div style=clear:both></div><div style="bgcolor:#f0f;padding-top:20px"><input type="checkbox" id="cancelled'+datetime+'"'+(cancelled?' checked':'')+' onclick="cancelORreviveEvent(\''+datetime+'\');" style="float:left"><div style="font-size:0.7em;margin-top:2px">Termin fällt aus</div></div><div class="prompt_text_bottom"><br><a href=javascript:hide_prompt()>Abbrechen</a></div></div>';
  document.getElementById('mobile_inner').style.display='none';
  addOnKeyCode13EventListener('comment'+datetime,'okCommentEdit');
  e.style.display='block';
  document.getElementById('comment'+datetime).focus();
}

function display_hour_selection(blockNumber) {
	if (!blockNumber) {blockNumber=''}
  var viewstate='inline';
  var element_weekday=document.getElementById('weekday'+blockNumber);
  if (element_weekday) {
    if (element_weekday.value==8) {viewstate='none'}
    document.getElementById('hour'+blockNumber).style.display=viewstate;
    document.getElementById('minute'+blockNumber).style.display=viewstate;
  }
}

function toggleView() {
  message('',false);
  var e=document.getElementById('mobile_main');
  if (e.currentStyle?e.currentStyle.display=='none':getComputedStyle(e, null).display=='none') {showView('mobile_main')} else {showView('mobile_options')}
}

function showView(view_to_display) {
  currentView=view_to_display;
  if (currentView=='mobile_options') {
    document.getElementById('mobile_options').style.display='block';
    document.getElementById('mobile_main').style.display='none';
    showQRcode(""+window.location);
    SocketIO();
    //navigator.serviceWorker.register('/service-worker.js');
  } else {
    document.getElementById('mobile_main').style.display='block';
    document.getElementById('mobile_options').style.display='none';
  }
}

function stopwatch(time) {
  if (typeof time != 'undefined') {
    return new Date()-time;
  } else {return new Date()}
}

function serverRequest(apicall,json,callback) {
  var t=stopwatch();
  var req = new XMLHttpRequest();
  req.onreadystatechange = function() {if (this.readyState == 4) {console.log(apicall+': '+stopwatch(t)+'ms'); callback(this.responseText)}};
  req.open("POST","/api/"+apicall,true);
  req.setRequestHeader("Content-Type","application/json;charset=UTF-8");
  req.send(JSON.stringify(json));
}

function getTeam(teamid) {
  if (!teamid) {teamid=window.location.pathname.substr(1).toLowerCase()}
  if (teamid) {
    // check if current URL matches with requested teamid
    if (teamid!=window.location.pathname.substr(1)) {
      // if not, relocate
      window.location.href=window.location.href.split('/')[0]+teamid;
    } else {
      // else, request team-data
      if (socket) {
        setTimeout(function(){socket.emit('getTeam',{token:getCookie('token',true),teamid:teamid})},0);
      } else {
        serverRequest('getTeam',{token:getCookie('token',true),teamid:teamid},function (r){updateView(r)});
      }
    }
  } else {updateView()}
}

function updateStatus(json) {
  message('',false);
  debug(json);
  // call getTeam if socket will not take care of updateView (because it has not been loaded yet)
  // OR to URL-relocate if teamid changed (getTeam will take care of that)
  var o=JSON.parse(json);
  if ( (!socket) || ((team.teamid!=o.teamid)&&(o.teamid!=undefined)) ) {
    SocketIO();
    getTeam(o.teamid?o.teamid:'');
  }
}

function findEvent(team,datetime) {
  if (team.events instanceof Array) {
    return team.events.find(function(e) {return e.datetime==datetime})||false;
  } else {return false}
}

function toggleStatus(datetime) {
  var e=findEvent(team,datetime);
  var name=getCookie('name',true);
  if (e.attendees&&e.attendees.includes(name)) {changeStatus("refuse",datetime)}
  else if (e.refusals&&e.refusals.includes(name)) {changeStatus("undecided",datetime)}
  else {changeStatus("attend",datetime)}
}

function changeStatus(status,datetime) {
  // prompt for name if name is not set
  // since this DOM-client-prompt-fake does not have a callback-option, recall this function via js-injection
  if (!getCookie('name',true)) {
    show_cookie_prompt('name','changeStatus(\''+status+'\',\''+datetime+'\');');
  } else {
    var timeout=setTimeout(function() {
      var e=document.getElementById('status'+datetime);
      e.className='statusbutton_wait';
      e.innerHTML='connecting ...'
    },250);
    serverRequest(status,{token:getCookie('token',!team.teamtoken),teamid:window.location.pathname.substr(1),datetime:datetime,name:getCookie('name')},function (r){clearTimeout(timeout); updateStatus(r);});
  }
}

function addTeam() {
  serverRequest('addTeam',{teamid:document.getElementById('teamid').value,name:document.getElementById('name').value,teamtoken:document.getElementById('teamtoken').value,admintoken:document.getElementById('admintoken').value,recurrence:[{weekday:document.getElementById('weekday0').value,time:document.getElementById('hour0').value+':'+document.getElementById('minute0').value}]},function (r){if (JSON.parse(r).hasOwnProperty('teamid')) {window.location.href = '/'+JSON.parse(r).teamid;} else {debug(r)}});
}

function editTeam() {
  var recurrences=undefined;
  var i=-1;
  while (i++<6) {
    var wd='weekday'+i; var hr='hour'+i; var min='minute'+i;
    if (document.getElementById(wd)&&document.getElementById(hr)&&document.getElementById(min)) {
      if (!recurrences) {recurrences=[]}
      // do not save weekday:8 (unregelmäßig), because it doesn't matter
      if (document.getElementById(wd).value!=8) {
        recurrences.push({weekday:document.getElementById(wd).value,time:document.getElementById(hr).value+':'+document.getElementById(min).value});
      }
    }
  }
  serverRequest('editTeam',{token:getCookie('token',true),teamid:document.getElementById('teamid')?document.getElementById('teamid').value:undefined,new_teamid:document.getElementById('new_teamid')?document.getElementById('new_teamid').value:undefined,name:document.getElementById('name')?document.getElementById('name').value:undefined,teamtoken:document.getElementById('teamtoken')?document.getElementById('teamtoken').value:undefined,admintoken:document.getElementById('admintoken')?document.getElementById('admintoken').value:undefined,recurrence:recurrences},function (r){updateStatus(r);});
}

function deleteTeam() {
  serverRequest('deleteTeam',{token:getCookie('token',true),teamid:document.getElementById('teamid').value},function (r){updateStatus(r);showView('mobile_main');});
}

function addEvent() {
  serverRequest('addEvent',{token:getCookie('token',true),teamid:window.location.pathname.substr(1),datetime:document.getElementById('datetime').value,comment:document.getElementById('comment').value},function (r){updateStatus(r);toggleView();});
}

function cancelORreviveEvent(datetime) {
  if (document.getElementById('cancelled'+datetime).checked) {cancelEvent(datetime)} else {reviveEvent(datetime)}
}

function cancelEvent(datetime) {
  serverRequest('cancelEvent',{token:getCookie('token',true),teamid:window.location.pathname.substr(1),datetime:datetime},function (r){updateStatus(r);});
}

function reviveEvent(datetime) {
  serverRequest('reviveEvent',{token:getCookie('token',true),teamid:window.location.pathname.substr(1),datetime:datetime},function (r){updateStatus(r);});
}

function commentEvent(datetime) {
  serverRequest('commentEvent',{token:getCookie('token',true),teamid:window.location.pathname.substr(1),datetime:datetime,comment:document.getElementById('comment'+datetime).value},function (r){updateStatus(r);});
}

function deleteEvent(datetime) {
  serverRequest('deleteEvent',{token:getCookie('token',true),teamid:window.location.pathname.substr(1),datetime:datetime},function (r){updateStatus(r);});
}

function load() {
  serverRequest('load',{token:getCookie('token',true)},function (r){updateStatus(r);});
}

function save() {
  serverRequest('save',{token:getCookie('token',true)},function (r){updateStatus(r);});
}

function dump() {
  serverRequest('dump',{token:getCookie('token',true)},function (r){updateStatus(r);});
}

function getLog() {
  serverRequest('getLog',{token:getCookie('token',true)},function(r){console.log(r);});
}

function getDateString(d) {
  if (!d) {d=new Date()}
  var tzoffset = d.getTimezoneOffset() * 60000;
  return (new Date(d-tzoffset)).toISOString().slice(0, -14);
}

function showQRcode(url) {
  if (typeof QRCode == 'undefined') {
    loadScript('/qrcode.min.js',function(){QRCode.toCanvas(document.getElementById('qrcode'), url, function (error) {if (error) console.error(error)})});
  } else {QRCode.toCanvas(document.getElementById('qrcode'), url, function (error) {if (error) console.error(error)})}
  document.getElementById('qrcode').style.display='inline';
}

function getCookie(cname,dontask) {
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i = 0; i < ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      var res=c.substring(name.length, c.length);
      return res;
    }
  }
  if (dontask) {return} else {return askCookie(cname)}
}

function askCookie(cname) {
  var preval=getCookie(cname,true);
  var val = prompt("Please enter "+cname, preval);
  return setCookie(cname, val, 365); //-1 = sessioncookie
  //show_cookie_prompt(cname);
}
function show_cookie_prompt(cname,str_functionToCall) {
  var text='???';
  var placeholder='';
  var preval=(getCookie(cname,true)||'');
  if (cname=='name') {text='Bitte gib deinen <b>Namen</b> ein:'; placeholder='Name';}
  else if (cname=='token') {text='Bitte gib deinen <b>Token</b> ein:'; placeholder='Token';}
  var e=document.getElementById('mobile_prompt');
  e.innerHTML='<div class="prompt_wrapper"><div class="prompt_text_top">'+text+'</div><input type="text" id="cinput" maxlength=24 value="'+preval+'" placeholder="'+placeholder+'" autocomplete="off"><button aria-label="ok" class="button_ok" id="okCookie" onclick="setCookie(\''+cname+'\',document.getElementById(\'cinput\').value,365);hide_prompt();'+(str_functionToCall||'')+'">ok</button><div style=clear:both></div><div class="prompt_text_bottom">Diese Information wird als Cookie in deinem Browser gespeichert.<br><br><a href=javascript:hide_prompt()>Abbrechen</a></div></div>';
  document.getElementById('mobile_inner').style.display='none';
  addOnKeyCode13EventListener('cinput','okCookie');
  e.style.display='block';
  document.getElementById('cinput').focus();
}

function setCookie(cname, cvalue, exdays) {
  var expires='';
  cvalue=cvalue.replace(/[^\w\s\däüöÄÜÖß\.,!\@#$^&*()\+=\-\[\]\/{}\|:\?']/g,'').trim().slice(0,140);
  if (cvalue==""||cvalue==null) {exdays=0} //0 = delete cookie
  if (exdays>=0) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    expires = "expires="+d.toUTCString();
  }
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
  getTeam();
  return getCookie(cname,true);
}

function debug(text) {
  console.log(text);
  if ((text=='false')||(JSON.parse(text).error)) {
    message('<span style=color:#f00>Das hat leider nicht funktioniert.</span>')
    if (JSON.parse(text).error) {message('<span style=color:#f00>'+JSON.parse(text).error+'</span>')}
  }
}

function check_mobile()
{
  var old_mobile_status=is_mobile;
  var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
  var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
  if ( (width<=800) && (is_mobile!=-1) )//|| ((display_state(document.getElementById('mobile'))==='block')&&(is_mobile!=-1)) )
  {
    is_mobile=1;
    //console.log('mobile YES');
    //document.getElementById('under_mobile').style.display='none';
    document.getElementById('mobile').style.maxWidth='100vw';
    document.getElementById('mobile').style.height='100vh';
    document.getElementById('mobile').style.top=0;
    document.querySelector("meta[name=viewport]").setAttribute('content','initial-scale=1');
  }
  else
  {
    if (is_mobile>0) {is_mobile=0}
    //console.log('mobile NO');
    //document.getElementById('under_mobile').style.display='block';
    document.getElementById('under_mobile').style.backgroundImage='url(images/phone.svg)';
    if (!document.getElementById("logoutIMG")) {
      var img = document.createElement("IMG");
      img.id='logoutIMG';
      img.src='/images/logout.svg';
      img.style.position='fixed';
      img.style.bottom='10px';
      img.style.right='10px';
      img.style.width='60px';
      img.addEventListener('click',function(e){window.open('/','_self').close();});
      img.style.cursor='pointer';
      document.getElementById('under_mobile').appendChild(img);
      //<img src="/images/logout.svg" style="position:fixed;bottom:10px;right:10px;width:60px">
    }

    var width=380;
    document.getElementById('mobile').style.maxWidth=width+'px';
    document.getElementById('under_mobile').style.backgroundSize=width+58+'px 100%';
    document.getElementById('mobile').style.height='85%';
    document.getElementById('mobile').style.top='8%';
    document.querySelector("meta[name=viewport]").setAttribute('content','width=800,initial-scale=1');
  }
  if (old_mobile_status!=is_mobile) {}
}

function hide_prompt(text,preval) {
  document.getElementById('mobile_prompt').style.display='none';
  document.getElementById('mobile_inner').style.display='block';
}

function message(msg,display) {
  var e=document.getElementById('mobile_message');
  if (display==false) {e.style.display='none'} else {
    document.getElementById('message').innerHTML=msg;
    e.style.display='block';
  }
}

var dblclickTimer=null;
function _ondblclick(dblclick) {
  if (dblclickTimer==null) {
    dblclickTimer=setTimeout(function(){dblclickTimer=null}, 400);
  } else {
    clearTimeout(dblclickTimer);
    dblclickTimer=null;
    dblclick();
  }
}

</script>
<noscript>Your browser does not support JavaScript!</noscript>

<style>
/* roboto-slab-regular - latin-ext */
/*
@font-face {
  font-family: 'Roboto Slab';
  font-style: normal;
  font-weight: 400;
  font-display: fallback;
  src: url('/fonts/roboto-slab-v7-latin-ext-regular.eot');
  src: local('Roboto Slab Regular'), local('RobotoSlab-Regular'),
       url('/fonts/roboto-slab-v7-latin-ext-regular.eot?#iefix') format('embedded-opentype'),
       url('/fonts/roboto-slab-v7-latin-ext-regular.woff2') format('woff2'),
       url('/fonts/roboto-slab-v7-latin-ext-regular.woff') format('woff'),
       url('/fonts/roboto-slab-v7-latin-ext-regular.ttf') format('truetype'),
       url('/fonts/roboto-slab-v7-latin-ext-regular.svg#RobotoSlab') format('svg');
}
*/
/* roboto-regular - latin-ext */
@font-face {
  font-family: 'Roboto';
  font-style: normal;
  font-weight: 400;
  font-display: block;
  src: url('/fonts/roboto-v18-latin-ext-regular.eot'); /* IE9 Compat Modes */
  src: local('Roboto'), local('Roboto-Regular'),
       url('/fonts/roboto-v18-latin-ext-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
       url('/fonts/roboto-v18-latin-ext-regular.woff2') format('woff2'), /* Super Modern Browsers */
       url('/fonts/roboto-v18-latin-ext-regular.woff') format('woff'), /* Modern Browsers */
       url('/fonts/roboto-v18-latin-ext-regular.ttf') format('truetype'), /* Safari, Android, iOS */
       url('/fonts/roboto-v18-latin-ext-regular.svg#Roboto') format('svg'); /* Legacy iOS */
}
  * {-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;}
  body {padding:0; margin:0;font-family: 'Roboto', serif; font-size: 1.6em; color:#000; background-color:#c2c2c2;word-wrap: break-word;}
  /*
    green #86E082 #5BCF55 #3BBA34 #1DA416 #0E8108
    red   #FE9395 #FD686C #E34044 #C81B20 #9E090D
    brown #FFC393 #FFAC69 #E58A41 #CA691B #A04C0A
    blue  #6FBFBC #409B98 #278B87 #117B77 #06615E
  */
  .bigscreen {
    height:100vh;
    position:relative;
  }
  .under_mobile {
    display:none;
    position:fixed;
    width:100%; height:100%;
    background-repeat: no-repeat;
    background-position: top center;
    background-size: 490px 100%;
  }
  .mobile {z-index:1; background-color: #c2c2c2; padding:0; position:relative; overflow:auto; margin:auto;}
  .mobile_prompt {
    z-index:2;
    overflow:auto;
    margin:auto;
    position: relative;
    display: none;
    padding: 3px;
  }
  .mobile_inner {padding: 3px}
    .head {padding-bottom: 5px}
    .main {overflow:hidden; overflow-wrap:break-word;}
    .options {display:none;}
    .admin {display:none}
    .footer {}

  a {color:inherit}
  a:hover {color:rgb(0,0,0)}
  select, input, button {font-family: 'Roboto', serif; font-size: 1em; padding: 0 0.5em 0 0.5em; border-style: none; border-radius: 0.1em; background-color:rgb(235,235,235); outline:0; height:50px; margin:0 0 0.4em 0;}

  input {display:inline; width:100%}
  input[type='checkbox'] {width:1em; height:1em; margin:0 9px 0.4em 9px;}

  button {
    border-radius: 0.1em;
    position: relative; overflow: hidden; display:inline-block; cursor: pointer;
    background-color:#A2A2A2; background-image:linear-gradient(#A2A2A2 84%,#A2A2A2 0%);
    margin: 0 0px 0px 0;
    height:50px; letter-spacing: -0.9px; text-align: center;
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.16), 0 1px 1px rgba(0, 0, 0, 0.1);
  }
  button:before {
    -webkit-transition: 0.22s all ease;
    transition: 0.22s all ease;
    position: absolute;
    top: 92%;
    left: 0;
    bottom: 0;
    content: '';
    background-color: #000;
    opacity: 0.4;
    z-index: 2;
  }
  button:hover:before {
    top: 84%;
    right: 0;
    opacity: 0.24;
  }

  div.head_wrapper {
    border-radius: 0.1em; margin: 6px 6px 2px 6px; padding: 9px 9px 0px 9px; text-align: left; min-height:72px;
  }
  div.form_wrapper {
    border-radius: 0.1em; margin: 6px 6px 0px 6px; padding: 0px 9px 20px 9px; text-align: left;
  }
  div.textblock_wrapper {
    border-radius: 0.1em; margin: 20px 6px 20px 6px; padding: 0px 9px 0px 9px; text-align: left; font-size: 0.7em;
  }
  div.error_wrapper {
    border-radius: 0.1em; border-style:solid; border-width:0px; border-color:#9E090D; margin: 0px 6px 12px 6px; padding:28px 22px 42px 22px; background-color:#fff; text-align: center;
  }
  div.error_text {
    font-size: 0.7em;
  }
  div.error_code {
    font-family: monospace; font-size: 0.7em;
  }
  div.options_wrapper {
    border-radius: 0.1em; margin: 0px 6px 18px 6px; padding: 0px 0px 0px 0px; text-align: left;
  }
  div.options_option {
    border-radius: 0.1em; margin:0px 0px 9px 0px; padding: 9px 9px 9px 9px; background-color: #fff; min-height:68px; overflow: wrap;
  }
  div.options_promo {
    border-radius: 0.1em; margin:0px 0px 9px 0px; padding: 9px 9px 18px 9px; background-color: #fff; min-height:68px; overflow: wrap; text-align:center;
  }
  div.option_text {
    font-size:0.7em; padding:0px 0px 4px 0px;
  }
  button.option_button {
    float:right; margin:0px 0px 0px 8px; height: 50px; width: 50px;
  }
  div.divider {
    border-radius: 0.1em; margin:0px 0px 0px 0px; padding: 9px 9px 9px 9px; min-height:10px; overflow: wrap; font-size: 0.7em;
  }
  div.admin_wrapper {
    border-radius: 0.1em; margin: 0px 6px 12px 6px; padding: 0px 6px 0px 9px; text-align: left;
  }
  div.attendeescount_wrapper {
    padding: 6px 6px; text-align: center; font-size:1em;
  }
  div.comment_wrapper {
    background-color: #fff; margin: 0px 0px 6px 0px; padding: 0px; text-align: center; display:inline-block; width:90%;
  }
  div.comment_important {
    border-radius: 0.1em; background-color:#E81B20; color:#fff; margin: 0px 0px 6px 0px; padding: 5px; text-align: center; display:inline-block; width:80%;
  }
  div.comment_hint {
    border-radius: 0.1em; background-color:#ff0; margin: 0px 0px 6px 0px; padding: 5px; text-align: center; display:inline-block; width:80%;
  }
  div.footer_wrapper {
    border-radius: 0.1em; margin: 6px 6px 20px 6px; padding: 9px 9px 9px 9px; text-align: left;
  }
  div.statusbutton_wrapper {
    border-radius: 0.1em; margin: 0px 6px 12px 6px; padding: 20px 0 10px 0; background-color:#fff; text-align: center; font-size:0.7em;
  }
  div.prompt_wrapper {
    border-radius: 0.1em; margin: 12px 6px 12px 6px; padding: 20px 16px 20px 16px; background-color:#fff; text-align: left;
  }
  div.prompt_text_top {
    font-size:0.7em; width:100%; text-align:left; padding:0px 10px 10px 10px;
  }
  div.prompt_text_bottom {
    font-size:0.7em; width:100%; text-align:left; padding:10px 10px 10px 10px;
  }

  button.statusbutton_undecided, button.statusbutton_attending, button.statusbutton_refused, button.statusbutton_wait {
    cursor: pointer; width:80%; margin:0px 0px 8px 0px; font-size:1.4em;
  }
  button.statusbutton_undecided {color:#000; background-color:#ffbf00; background-image:linear-gradient(#ffbf00 84%,#efaf00 0%);}
  button.statusbutton_attending {color:#000; background-color:#1DA416; background-image:linear-gradient(#1DB416 84%,#1DA416 0%);}
  button.statusbutton_refused   {color:#000; background-color:#C81B20; background-image:linear-gradient(#E81B20 84%,#D81B20 0%);}
  button.statusbutton_wait      {color:#000; background-color:#C0C0C0; background-image:linear-gradient(#C0C0C0 84%,#A0A0A0 0%);}

  button.button_ok {float:right; margin-right:0px; width:100%;}

  div.statusbutton_wrapper_attendees_first {padding:8px;}
  div.statusbutton_wrapper_attendees_following {background-color: #fff; padding:8px 8px 0px 8px;}
  div.attendee_item, div.refusal_item {display:inline-block; white-space: nowrap; background-color:#ddd; border:2px solid #ddd; border-radius: 0.1em; padding:4px; margin:0px 4px 8px 4px;}
  div.attendee_item {}
  div.refusal_item {color:#888; text-decoration:line-through; background-color:#fff; border:2px solid #ddd;}

  div.message {
    border-radius: 0.1em; margin: 0px 21px 15px 21px; padding:0px 22px 12px 22px; background-color:#fff; color:#000; text-align:left; font-size: 0.7em; cursor:pointer; top:-24px; display:none;
  }
  #triangle-up {
    width: 0; height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 12px solid #fff;
    top:-12px;
    position:relative;
  }

@media only screen and (max-width: 320px) {body{font-size:1.4em}}
@media only screen and (min-width: 800px) {
  body {
    background-image:linear-gradient(#7F7F7F 78%, #696969 0%);
  }
  .mobile {
  }
  .under_mobile {
    display:block;
  }
}

</style>

</head>
<body onload="getTeam();check_mobile();" onresize="check_mobile()">

<div id="bigscreen" class="bigscreen">
  <div id="under_mobile" class="under_mobile" display="none"></div>
  <div id="mobile" class="mobile">
    <div id="mobile_prompt" class="mobile_prompt"></div>
    <div id="mobile_inner" class="mobile_inner">
      <header>
        <div id="mobile_head" class="head"></div>
      </header>
      <main>
        <div id="mobile_message" onclick="javascript:this.style.display='none'" class="message"><div id=triangle-up></div><div id="message"></div></div>
        <div id="mobile_options" class="options"></div>
        <div id="mobile_main" class="main"></div>
      </main>
      <footer>
        <div id="mobile_footer" class="footer"></div>
      </footer>
    </div>
  </div>
</div>

</body>

</html>
