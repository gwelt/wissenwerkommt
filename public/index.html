<!DOCTYPE html>
<html>
<body>

<h2>wissenwerkommt</h2>

Team-ID: <input id="teamid" type="text" maxlength="64" value="fbhh">
Datetime: <input id="datetime" type="text" maxlength="64" value="2018-09-13T18:30">
Name: <input id="name" type="text" maxlength="64" value="sven">
<button type="button" onclick="getTeam()">load</button>
<button type="button" onclick="changeStatus('attend')">attend</button>
<button type="button" onclick="changeStatus('refuse')">refuse</button>
<button type="button" onclick="changeStatus('undecided')">undecided</button>

<br><br><div id="status"></div>
<br><div id="teams"></div>

<script>
function getTeam(teamid) {
  if (!teamid) {teamid=document.getElementById('teamid').value;}
  ajax((r)=>{updateView(r)},{action:'getTeam',teamid:teamid});
}

function changeStatus(status,teamid,datetime,name) {
  if (!teamid) {teamid=document.getElementById('teamid').value;}
  if (!datetime) {datetime=document.getElementById('datetime').value;}
  if (!name) {name=document.getElementById('name').value;}
  ajax((r)=>{updateStatus(r)},{action:status,teamid:teamid,datetime:datetime,name:name});
}

function updateView(json) {
  let o=JSON.parse(json);
  document.getElementById("teams").innerHTML = JSON.stringify(o);
}

function updateStatus(json) {
  let o=JSON.parse(json);
  document.getElementById("status").innerHTML = JSON.stringify(o);
  getTeam();
}

function ajax(callback,json) {
  var req = new XMLHttpRequest();
  req.onreadystatechange = function() {if (this.readyState == 4 && this.status == 200) {callback(this.responseText)}};
  req.open("POST","/api/ajax",true);
  req.setRequestHeader("Content-Type","application/json;charset=UTF-8");
  req.send(JSON.stringify(json));
}
</script>

</body>
</html>
